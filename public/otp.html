<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Vo Tan Binh from SPACEAPP Team" />
    <meta name="description" content="Verify Page" />
    <title>SPACEAPP | Verify</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style/formstyle.css">
    <link rel="icon" href="img/APPICONEXTGEN.webp">
    <style>
      /* override any global min-width on cards */
      .auth-card { width:100%; max-width:560px; min-width:auto !important; background: rgba(245, 245, 247, 0.747);}
      .form-control, .btn, .form-select { min-height: 3rem; }
    </style>
  </head>
  <body>
    <main>
      <section class="container py-3">
        <section class="row justify-content-center">
          <section class="col-12 col-md-10 col-lg-8 d-flex flex-column align-items-center">
            <h1 class="mb-2 Title text-center w-100">SPACEAPP</h1>

            <section class="card auth-card rounded-3 shadow mt-2 p-3 p-md-4">
              <section class="card-body">
                <section id="error-box" class="alert alert-danger alert-dismissible fade show d-none" role="alert">
                  <span id="error-text"></span>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </section>

                <form class="needs-validation" novalidate action="/verify" method="post">
                  <section class="mb-3">
                    <label class="label my-1" for="verifyOTP">We've sent a vertification email to your registered email address. Please type in the OTP we sent you.</label>
                    <input type="text" name="otp" class="form-control mt-2" id="verifyOTP" placeholder="Your OTP Code" autocomplete="false" maxlength="6" required>
                    <section class="invalid-feedback">Please enter a code</section>
                  </section>

                  <section class="d-grid gap-3">
                    <button type="submit" class="btn btn-primary btn-md mt-2"><i class="bi bi-check-circle me-1"></i>Verify</button>
                  </section>
                  
                  <p class="mt-3 text-center">
                    <button type="button" class="btn btn-secondary mt-1 mb-0 text-nowrap" style="background: transparent; border: 0px; color:rgb(19, 78, 120)" id="resendBtn">Didn't see any code? Resend it!</button>
                  </p>
                </form>
              </section>
            </section>
        </section>
      </section>
    </main>

    <script>
      // show backend error message if present
      const params = new URLSearchParams(window.location.search);
      if (params.has("error")) {
        const box = document.getElementById("error-box");
        const text = document.getElementById("error-text");
        box.classList.remove("d-none");
        box.classList.add("show");
        text.textContent = params.get("error");
        setTimeout(() => {
          box.classList.remove("show");
          setTimeout(() =>{
            box.classList.add("d-none");
          }, 200);
        }, 5000);
      }
      if (params.has("success")) {
        const next = '/';
        alert("✅ Verification Successful!");
        let main = window.open('', 'main-site');
        main.location.href = next + (next.includes("?") ? "&" : "?") + "t=" + Date.now();
        window.close();
        // window.location.href = "/";
      }

      document.getElementById("resendBtn").addEventListener('click', async () =>{
        const res = await fetch("/resend-otp");
        const data = await res.json();
        if (data.success) {
            alert("✅ OTP resent successfully!");
        } else {
            alert("❌ " + data.error);
        }
      });
      // bootstrap validation
      (() => {
        'use strict';
        const forms = document.querySelectorAll('.needs-validation');
        Array.from(forms).forEach((form) => {
          form.addEventListener('submit', (event) => {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add('was-validated');
          }, false);
        });
      })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  </body>
</html>

