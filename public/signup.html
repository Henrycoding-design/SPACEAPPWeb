<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Vo Tan Binh from SPACEAPP Team" />
    <meta name="description" content="SignUp Page" />
    <title>SPACEAPP | Sign Up</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style/formstyle.css">
    <link rel="icon" href="img/webicon.webp">
    <style>
      .auth-card { width:100%; max-width:560px; min-width:auto !important; }
      .form-control, .btn, .form-select { min-height: 3rem; }
    </style>
  </head>
  <body>
    <main>
      <section class="container py-3">
        <section class="row justify-content-center">
          <section class="col-12 col-md-10 col-lg-8 d-flex flex-column align-items-center">
            <h1 class="mb-2 Title text-center w-100">SPACEAPP</h1>

            <section class="card auth-card rounded-3 shadow mt-2 p-3 p-md-4">
              <section class="card-body">
                <section id="error-box" class="alert alert-danger alert-dismissible fade show d-none" role="alert">
                  <span id="error-text"></span>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </section>

                <form class="needs-validation" novalidate action="/signup" method="post">
                  <section class="mb-3">
                    <label class="label my-1" for="signupEmail">Email</label>
                    <input type="email" name="email" class="form-control" id="signupEmail" placeholder="example@gmail.com" autocomplete="email" required>
                    <section class="invalid-feedback">Please enter a valid email</section>
                  </section>

                  <section class="mb-3">
                    <label class="label my-1" for="signupPassword">Password</label>
                    <section class="input-group">
                      <input type="password" name="password" class="form-control" id="signupPassword" minlength="6" maxlength="18" autocomplete="new-password" required oninput="checkMatch()">
                      <button type="button" class="btn btn-outline-secondary" aria-label="Show passwords" onclick="togglePassword('signupPassword', 'signupConfirm', this)">
                        <i class="bi bi-eye"></i>
                      </button>
                    </section>
                    <section class="invalid-feedback">Password must be 6â€“18 characters</section>
                  </section>

                  <section class="mb-3">
                    <label class="label my-1" for="signupConfirm">Confirm Password</label>
                    <input type="password" class="form-control" id="signupConfirm" autocomplete="new-password" required oninput="checkMatch()">
                    <section class="invalid-feedback">Passwords must match</section>
                  </section>

                  <section class="form-check my-3">
                    <input class="form-check-input" type="checkbox" id="signupAgree" required>
                    <label class="form-check-label" for="signupAgree">
                      You agree with our <a href="PrivatePolicy.html" target="_blank" class="text-decoration-none">Terms</a>
                    </label>
                    <section class="invalid-feedback">This is required</section>
                  </section>

                  <section class="d-grid gap-3">
                    <button type="submit" class="btn btn-primary btn-md">Create Account</button>
                  </section>

                  <p class="mt-3 text-center">
                    <button type="button" class="btn btn-secondary mt-1 mb-0" style="background: transparent; border: 0px; color:rgb(19, 78, 120)" onclick="window.location.href='login.html'">Already have an account? Log In</button>
                  </p>
                </form>
              </section>
            </section>
          </section>
        </section>
      </section>
    </main>

    <script>
      // show backend error message if present
      const params = new URLSearchParams(window.location.search);
      if (params.has("error")) {
        const box = document.getElementById("error-box");
        const text = document.getElementById("error-text");
        box.classList.remove("d-none");
        text.textContent = params.get("error");
      }

      function checkMatch() {
        const pw = document.getElementById("signupPassword");
        const confirm = document.getElementById("signupConfirm");
        confirm.setCustomValidity("");

        if (confirm.value === "") {
          confirm.classList.remove("is-valid", "is-invalid");
          return;
        }
        if (pw.value !== confirm.value) {
          confirm.setCustomValidity("Passwords do not match");
          confirm.classList.remove("is-valid");
          confirm.classList.add("is-invalid");
        } else {
          confirm.setCustomValidity("");
          confirm.classList.remove("is-invalid");
          confirm.classList.add("is-valid");
        }
      }

      // bootstrap validation
      (() => {
        'use strict';
        const forms = document.querySelectorAll('.needs-validation');
        Array.from(forms).forEach((form) => {
          form.addEventListener('submit', (event) => {
            if (!form.checkValidity()) {
              event.preventDefault();
              event.stopPropagation();
            }
            form.classList.add('was-validated');
          }, false);
        });
      })();

      function togglePassword(pwId, confirmId, btn) {
        const pw = document.getElementById(pwId);
        const confirm = document.getElementById(confirmId);
        const icon = btn.querySelector("i");
        const toText = pw.type === "password"; // mirror both fields
        pw.type = toText ? "text" : "password";
        confirm.type = toText ? "text" : "password";
        icon.classList.toggle("bi-eye", !toText);
        icon.classList.toggle("bi-eye-slash", toText);
        btn.setAttribute('aria-label', toText ? 'Hide passwords' : 'Show passwords');
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  </body>
</html>